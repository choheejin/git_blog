# daemon

### 죽여도 죽여도 살아나는 무서운 자식..

어제 하루종일 EC2 서버랑 씨름 하고 왔다... (사실 최근 일주일 내내 ㅋㅋ)

문제 상황 1. 도커 마운트가 안 바뀜.\
문제 상황 2. 계속 모르는 도커가 실행되고 있음\
문제 상황 3. sudo docker stop 명령어가 안 먹힘\
문제 상황 4. jenkins가 500 에러를 띄움\
문제 상황 5. 갑자기 turnserver 사라짐

서버가 안되니 프로젝트 진행이 안돼서 일단 인스턴스 삭제하고 빠르게 서버 셋팅을 다시 하고 배포를 진행했다.

### 도대체 뭐가 문제였을까..?

1. 도커 데몬에 대해서 몰랐다.\
   sudo kill을 해도 계속 포트를 잡아먹는 알 수 없는 도커 프로그램에 의해 패닉이 왔었다.\
   하지만, Ubuntu에서는 systemd가 Docker 데몬을 관리하므로, dockerd 프로세스를 강제 종료해도 다시 시작된다는 놀라운 사실....\
   즉.. 매우 당연한 상황이었던 것임. ㅋㅋㅋㅋㅋㅋㅋ\
   sudo systemctl stop docker docker.socket로 일시적으로 해결 됐었던 이유가 Docker 데몬과 Docker 소켓을 중지하는 명령어이기 때문...
2. 권한 설정이 꼬였을 것 같다\
   팀원이 도커 볼륨 삭제를 위해 프로그램 깔고 볼륨 지우고 하는 과정에서 도커의 권한 설정이 얽힌거 아닐까 추측해본다.\
   아니면, 내가 도커 작업할 때 젠킨스 푸시 요청이 들어가서 그런건가..? 여튼 꼬여도 단단히 꼬인거지 않나...\
   sudo aa-remove-unknown 를 통해 해결했어야 했다. (GPT가 알려줘서 했었던거 같긴 한데 이러고 나서 또 꼬인 걸수도,,ㅋㅋㅋ)
3. 도커 마운트가 안됨\
   이거는 아직도 잘 모르겠다. 젠킨스로 배포를 진행하면 ./ 로 경로 설정하면 돼야 하는거 아닌가.\
   권한도 그룹 만들어서 다 해줬는데 계속 권한이 부족하다고 에러가 떠서\
   그냥 git clone을 받아서 절대경로로 박았다 ㅎ.\
   init.sql 초기화는 자동 배포로 안되는걸롱...^^

### 배운점

인프라는 고독하다..ㅋㅋ

* 만약 내가 뭔가 설정을 변경하고 있다면, 앞으로 develop 브랜치로 훅 설정 되어 있는 것을 끄거나 푸시 하지 말아달라고 공지를 해야하지 않을까 싶다.

여담이지만,.. 진짜 힘들어 죽는 줄 알았다 ^^,,
