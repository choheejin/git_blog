# 블록체인 개요

## 블록체인의 개요

### 블록체인의 등장: 비트코인

* CypherPunk 운동
  * 정보, 거대 기업으로부터 개인의 권리와 자산을 지키기 위한 운동
  * 데이비드 차움, 줄리안 어산지, 사토시 나카모토 등 수십명이 참여
* 비트코인의 탄생
  * 2008년 CypherPunk 운동의 결과물로 화폐 권력의 중앙화를 없애기 위해 (익명의) 사토시 나카모토가 발명
  * 발행기관, 운영기관, 중개기관 없이 인터넷 상에서 다수의 사람들에게 신뢰받는 세계 최초의 탈중앙형 화폐 탄생
  * 2009년 1월 3일 사토시 나카모토의 첫 채굴이 일어나며 비트코인 네트워크 가동 시작
  * 비트코인 최초 블록(Genesis Block)에는 영국정부의 구제금융 발표 뉴스의 제목이 기록
* 블록체인 2.0
  * 비트코인 지지자 비탈릭 부테인은 비트코인을 확장하고자 제안하였으나, 당시 급진적인 제안으로 인해 새로운 블록체인, 이더리움을 개발하게 됨.
  * 업계 최초 ICO(Initail Coin Offering) 를 통해 개발비를 모금하였으며, 그 결과 2015년 이더리움 네트워크가 시작됨
  * 이더리움은 스마트 컨트랙트를 실행하는 탈중앙화된 컴퓨팅 인프라로 월드 컴퓨터라고 불림.
  * 블록체인에 스마트 컨트랙트 도입하여 DAO(Decentralized Autonomous Organization), 자기주권신원증명, 탈중앙형 금융 등의 가능성을 보여주고 Web 3.0의 기틀을 마련했다는 평가를 받음

### 블록체인의 정의

**p2p 네트워크**를 통해 관리되는 분산 데이터베이스의 한 형태로, 블록체인 노드(네트워크에 연결된 여러 컴퓨터)에 **디지털 서명된 거래 정보**를 보관하는 **분산 원장 기술**(Distributed Ledger Technology)

### 블록체인의 동작 원리

1. 누군가 트랜잭션을 만들어 요청한다.
2. 트랜잭션을 요청 받은 노드는 트랜잭션의 유효성을 검증한다.
3. 유효한 트랜잭션이 블록체인의 p2p 네트워크에 전파된다.
4. 블록 생성자는 블록 생성 규칙을 준수하며, 검증된 트랜잭션(1번의 트랜잭션)을 포함하는 새 블록을 생성한다.
5. 생성된 새로운 블록이 p2p 네트워크에 전파된다.
6. 기존 블록에 새로운 블록이 연결되며 트랜잭션이 처리된다.

## 블록체인의 암호학

### 공개키 암호화

* 공개키 암호화 == 비대칭 암호화
* 계산하기는 쉽지만 그 역을 계산하기 어려운 특수한 함수를 바탕으로 생성된 고유한 키를 사용하여 정보를 보호하는 방법
* 비트코인 및 이더리움에서는 이산 로그 문제를 이용하는 타원곡선암호화를 활용

### 개인키(k)

* 1\~2^{256} 사이의 무작위로 선택한 숫자
* 개인키 생성 프로세스는 오프라인 프로세스
* 대부분의 프로그래밍 언어에 있는 rand 함수 같은 암호학적으로 안전하지 않은 난수 생성기 사용 금지

### 공개키(K)

* 타원 곡선에 있는 점 (타원 곡선 방정식을 만족하는 x와 y 좌표의 집합)
* k: 개인키, G: 생성자 점이라 불리는 상수점, K: 공개키, \*: 일반 곱셈과 다른 특수한 곡선 곱하기 연산자
* 이더리움은 secp256k1을 사용한다.
  * 이더리움에서 16진수 문자 130개로 직렬화된 공개키를 확인할 수 있다.
  * 이더리움은 타원 곡선 공개키 접두어 04를 사용한다.

### 해시함수 - 주소 생성

* 공개키를 주소로 변환하기 위해 해시 함수 사용
* 해시함수
  * 임의 크기의 데이터를 고정된 크기 데이터로 매핑하는 함수
  * 해시 함수의 입력을 메시지 또는 입력 데이터, 결과를 해시(hash)라 함.
  * 결과값을 알고 있을 때, 입력 데이터를 다시 작성하는 것이 불가능한 단방향(one-way) 함수
* 이더리움에서는 keccak-256 함수를 사용
  * 공개키 입력의 keccak-256의 해시
  * 마지막 20바이트만 유지하여 주소로 사용
  * 16진수를 나타내는 0x 접두어가 함께 나타나기도 함.
  * 16진수의 대소문자를 수정하여 이더리움의 이전버전과 호환되도록 체크섬 주소를 사용

### 개인키 - 공개키 - 주소

개인키 k : 암호학적으로 무작위한 1\~2^{256} 사이의 난수

⬇️ 타원 곡선 함수 (Secp256k1)

공개키 K : 타원 곡선 위의 점을 직렬화 한 값

⬇️ 해시 함수 (keccak-256)

주소 : 해시의 마지막 20 바이트, 외부 소유 주소 (EOA)

## 트랜잭션

### 트랜잭션이란

* 외부 소유 계정에 의해 서명된 메시지
* 이더리움 네트워크에 전송되고 블록체인에 기록된다.
* 블록체인 상태 변경을 유발하거나 컨트랙트를 실행하는 유일한 방법이다.
  * 이더리움은 독자적으로 상태가 변경되지 않는다.
  * 컨트랙트는 독자적으로 실행되지 않는다.

### 트랜잭션의 구조

* 논스 nonce
  * 발신주소에 의해 발행된 일련번호
* 가스 가격 gas price
  * 발신자가 지급하는 가스의 가격
* 가스 한도 gas limit
  * 트랜잭션을 위해 지불 허용할 가스의 최대량
* 수신자 recipient
  * 목적지 이더리움 주소
* 값 value
  * 목적지에 보낼 이더의 양
* 데이터 data
  * 가변 길이의 바이너리 데이터 페이로드
* 디지털 서명 v,r,s
  * 트랜잭션 무결성 및 부인 방지를 위한 디지털 서명

### 논스 (none)

* 해당 주소에서 생성한 트랜잭션의 건수
* 논스 값은 0부터 시작하여 트랜잭션을 생성할 때마다 순차적으로 증가한다.
* 트랜잭션을 순차적으로 처리하기 위해 사용한다.
* 트랜잭션을 복제할 수 없게 한다.

### 가스

* 가스는 이더리움 네트워크를 사용하기 위한 수수료
* 이더에 대한 사용자 지정 환율을 가진 별도의 개념이다.
* 트랜잭션이 사용할 수 있는 자원의 양을 제어하는데 사용된다,

### 값과 데이터 (value & data)

* 트랜잭션의 주요 페이로드
* 총 네가지 조합 모두 유효하다.
  * 값만 있는 경우: 이더 지급
  * 데이터만 있는 경우: 호출
  * 값과 데이터 모두 있는 경우: 지급 + 호출
  * 값과 데이터 모두 없는 경우: 트랜잭션은 보내지만 가스 낭비
* 새로운 컨트랙트는 트랜잭션
  * 수신자 주소: 0x0 (영주소), 데이터: 컴파일 된 컨트랙트의 바이트 코드

### 디지털 서명

* 트랜잭션 정보를 개인키를 사용하여 서명
* 타원 곡선 디지털 서명 알고리즘을 사용하여 인코딩된 트랜잭션 정보를 EOA의 개인키를 이용하여 서명을 만든다.
* 트랜잭션 생성 → 트랜잭션 직렬화 → 트랜잭션 해시 → 디지털 서명 생성 → 트랜잭션과 서명 함께 직렬화
* 서명에 담긴 트랜잭션을 받은 누구나 메시지와 공개키만 사용하여 서명을 검증할 수 있다.
  * 개인키 소지자에 의해 트랜잭션이 승인되었음을 증명한다.
  * 개인키 소지자가 해당 트랜잭션을 승인했음을 부인할 수 없다.
  * 서명후 데이터가 수정되지 않았다.
